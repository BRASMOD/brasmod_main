header = T, dec = ",") %>%
mutate(across(everything(), as.numeric))
pnad_hh <- fread(paste0("Database setup\\Expenditure imputation\\PNAD data\\bra_",
as.character(year), "_std_hh.txt"), sep = "\t",
header = T, dec = ",") %>%
mutate(across(everything(), as.numeric))
pof_individual <- fread(paste0("Database setup\\Expenditure imputation\\POF data\\bra_", as.character(year), "_std.txt"),
sep = "\t",
header = T, dec = ",") %>%
mutate(across(everything(), as.numeric))
pof_hh <- fread(paste0("Database setup\\Expenditure imputation\\POF data\\bra_", as.character(year), "_std_hh.txt"),
sep = "\t",
header = T, dec = ",") %>%
mutate(across(everything(), as.numeric))
cpi <- read_xls("Database setup\\Expenditure imputation\\CPI (IPCA).xls")
inflation_correction <- cpi$price_level[cpi$year == year]
DESPESA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
DESPESA_INDIVIDUAL <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_INDIVIDUAL.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
CADERNETA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
mutate(V9001 = substr(V9001, 1, 5)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
tables_pof <- do.call(rbind,
list(DESPESA_COLETIVA,
DESPESA_INDIVIDUAL,
CADERNETA_COLETIVA)) %>%
mutate(across(everything(), as.numeric))
View(tables_pof %>% filter(substr(V9001, 1, -3) == "999"))
substr(60999, 1, -3) == "999"
substr(60999, 1, -3)
substr(60999, 0, -3)
substr(60999, 1, -3)
str_sub(60999, 1, -3)
str_sub(60999, -1, -3)
str_sub(60999, -3, -1)
str_sub(609998, -3, -1)
str_sub(609998234, -3, -1)
View(tables_pof %>% filter(str_sub(V9001, -3, -1) == "999"))
View(tables_pof %>% filter(idorighh == 110006893121))
View(tables_pof %>% filter(idorighh == 110006893121 & substr(V9001, 1,2) == "11"))
View(tables_pof %>% filter(str_sub(V9001, -3, -1) == "999"))
View(tables_pof %>% filter(str_sub(V9001, -3, -1) == "999"))
View(tables_pof %>% filter(str_sub(V9001, -3, -1) == "999" & substr(V9001, 1,2) == "17"))
View(tables_pof %>% filter(str_sub(V9001, -3, -1) == "999" & substr(V9001, 1,2) == "17" & V8000_DEFLA_new == 3061.815813 ))
View(tables_pof %>% filter(str_sub(V9001, -3, -1) == "999" & substr(V9001, 1,2) == "17"))
print(unique((tables_pof %>% filter(str_sub(V9001, -3, -1) == "999" & substr(V9001, 1,2) == "17"))$V8000_DEFLA_new)
)
length(unique((tables_pof %>% filter(str_sub(V9001, -3, -1) == "999" & substr(V9001, 1,2) == "17"))$V8000_DEFLA_new))
View(duplicated(tables_pof))
View(tables_pof %>% filter(duplicated == T))
View(tables_pof %>% filter(duplicated() == T))
sum(duplicated(tables_pof))
View(tables_pof[duplicated(tables_pof)])
tables_pof[duplicated(tables_pof)]
View(tables_pof)
View(tables_pof[duplicated(tables_pof[,1:3])])
View(tables_pof[duplicated(V8000_DEFLA_new)])
View(duplicated(tables_pof))
View(unique(tables_pof))
View(setdiff(unique(tables_pof), tables_pof))
View(setdiff(tables_pof, unique(tables_pof)))
class(duplicated(tables_pof))
x<- unique(tables_pof)
x<-duplicated(tables_pof)
which(x == TRUE)
lengt(which(x == T))
length(which(x == T))
View(tables_pof %>% filter(row_number == 2)
_
View(tables_pof %>% filter(row_number == 2))
View(tables_pof %>% filter(row_number() == 2))
View(tables_pof)
View(tables_pof %>% filter(row_number() %in% x))
View(tables_pof %>% filter(row_number() %in% which(x==T)))
inner_join(tables_pof %>% filter(row_number() %in% which(x==T)), tables_pof)
View(inner_join(tables_pof %>% filter(row_number() %in% which(x==T)), tables_pof))
DESPESA_COLETIVA_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
#mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
View(DESPESA_COLETIVA_2)
DESPESA_COLETIVA_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
#mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
DESPESA_INDIVIDUAL_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_INDIVIDUAL.rds") %>%
#mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
CADERNETA_COLETIVA_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
#mutate(V9001 = substr(V9001, 1, 5)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
tables_pof_2 <- do.call(rbind,
list(DESPESA_COLETIVA_2,
DESPESA_INDIVIDUAL_2,
CADERNETA_COLETIVA_2)) %>%
mutate(across(everything(), as.numeric))
View(tables_pof_2)
sum(duplicated(tables_pof_2))
sum(duplicated(tables_pof))
x_2 <-duplicated(tables_pof_2)
View(inner_join(tables_pof_2 %>% filter(row_number() %in% which(x_2==T)), tables_pof_2))
sum(duplicated(CADERNETA_COLETIVA_2))
DESPESA_COLETIVA_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
#mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12)
DESPESA_COLETIVA_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
#mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
CADERNETA_COLETIVA_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
#mutate(V9001 = substr(V9001, 1, 5)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12)
sum(duplicated(CADERNETA_COLETIVA_2))
X_3 <- duplicated(CADERNETA_COLETIVA_2)
CADERNETA_COLETIVA_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
#mutate(V9001 = substr(V9001, 1, 5)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12)
View(CADERNETA_COLETIVA_2 %>% filter(row_number() %in% which(x_3==T)))
which(x_3==T)
View(CADERNETA_COLETIVA_2 %>% filter(row_number() %in% which(X_3==T)))
sum(X_3)
CADERNETA_COLETIVA_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
#mutate(V9001 = substr(V9001, 1, 5)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
sum(duplicated(CADERNETA_COLETIVA_2))
x_3 <- duplicated(CADERNETA_COLETIVA_2)
which(X_3 == t)
which(X_3 == T)
which(x_3 == T)
CADERNETA_COLETIVA_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
#mutate(V9001 = substr(V9001, 1, 5)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12)
View(CADERNETA_COLETIVA_2 %>% filter(row_number() %in% which(x_3==T)))
View(CADERNETA_COLETIVA_2 %>% filter(row_number() %in% which(x_3==T)) %>% arrange(idorighh))
sum(duplicated(DESPESA_COLETIVA_2))
sum(duplicated(DESPESA_INDIVIDUAL_2))
x_4 <- duplicated(DESPESA_INDIVIDUAL_2)
DESPESA_INDIVIDUAL_2 <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_INDIVIDUAL.rds") %>%
#mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12)
View(DESPESA_INDIVIDUAL_2 %>% filter(row_number() %in% which(x_4==T)))
View(DESPESA_INDIVIDUAL_2 %>% filter(row_number() %in% which(x_4==T)) %>% arrange(idorighh))
tradutor <- read_xls("Database setup\\Expenditure imputation\\general_expenditure_translator.xls", )
habitacao          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Habitacao"]
despesas_diversas  <- tradutor$Codigo[tradutor$Descricao_3_novo == "Despesas diversas"]
prestacao          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Prestação de imóvel"]
impostos           <- tradutor$Codigo[tradutor$Descricao_3_novo == "Impostos"]
imovel             <- tradutor$Codigo[tradutor$Descricao_3_novo == "Imóvel (reforma)" |
tradutor$Descricao_3_novo == "Imóvel (aquisição)"]
outras             <- tradutor$Codigo[tradutor$Descricao_3_novo == "Outras"]
investimentos      <- tradutor$Codigo[tradutor$Descricao_3_novo == "Outros investimentos"]
cultura            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Recreação e cultura"]
contribuicoes_trab <- tradutor$Codigo[tradutor$Descricao_3_novo == "Contribuições trabalhistas"]
fumo               <- tradutor$Codigo[tradutor$Descricao_3_novo == "Fumo"]
transporte         <- tradutor$Codigo[tradutor$Descricao_3_novo == "Transporte"]
alimentacao        <- tradutor$Codigo[tradutor$Descricao_3_novo == "Alimentacao"]
serv_banc          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Serviços bancários"]
serv_pess          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Serviços pessoais"]
assist_saude       <- tradutor$Codigo[tradutor$Descricao_3_novo == "Assistencia a saude"]
higiene            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Higiene e cuidados pessoais"]
educacao           <- tradutor$Codigo[tradutor$Descricao_3_novo == "Educacao"]
vestuario          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Vestuario"]
emprestimo         <- tradutor$Codigo[tradutor$Descricao_3_novo == "Empréstimo"]
prev_priv          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Previdência privada"]
pensoes            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Pensões, mesadas e doações"]
str_sub(1234512, 1, -3)
str_sub(12342, 1, -3)
str_sub(1234212, 1, -3)
str_sub(12342125, 1, -3)
str_sub(600101, 1, -3)
substr(600101, 1, 5)
substr(1200101, 1, 5)
substr(2402002, 1, 5)
rm(list=ls())
cpi <- read_xls("Database setup\\Expenditure imputation\\CPI (IPCA).xls")
inflation_correction <- cpi$price_level[cpi$year == year]
year = 2019
cpi <- read_xls("Database setup\\Expenditure imputation\\CPI (IPCA).xls")
inflation_correction <- cpi$price_level[cpi$year == year]
DESPESA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
DESPESA_INDIVIDUAL <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_INDIVIDUAL.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12)
CADERNETA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
mutate(V9001 = substr(V9001, 1, 5)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12)
tables_pof <- do.call(rbind,
list(DESPESA_COLETIVA_2,
DESPESA_INDIVIDUAL_2,
CADERNETA_COLETIVA_2)) %>%
mutate(across(everything(), as.numeric))
tables_pof <- do.call(rbind,
list(DESPESA_COLETIVA,
DESPESA_INDIVIDUAL,
CADERNETA_COLETIVA)) %>%
mutate(across(everything(), as.numeric))
DESPESA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
DESPESA_INDIVIDUAL <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_INDIVIDUAL.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
CADERNETA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
mutate(V9001 = substr(V9001, 1, 5)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
tables_pof <- do.call(rbind,
list(DESPESA_COLETIVA,
DESPESA_INDIVIDUAL,
CADERNETA_COLETIVA)) %>%
mutate(across(everything(), as.numeric))
tradutor <- read_xls("Database setup\\Expenditure imputation\\general_expenditure_translator.xls", )
habitacao          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Habitacao"]
despesas_diversas  <- tradutor$Codigo[tradutor$Descricao_3_novo == "Despesas diversas"]
prestacao          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Prestação de imóvel"]
impostos           <- tradutor$Codigo[tradutor$Descricao_3_novo == "Impostos"]
imovel             <- tradutor$Codigo[tradutor$Descricao_3_novo == "Imóvel (reforma)" |
tradutor$Descricao_3_novo == "Imóvel (aquisição)"]
outras             <- tradutor$Codigo[tradutor$Descricao_3_novo == "Outras"]
investimentos      <- tradutor$Codigo[tradutor$Descricao_3_novo == "Outros investimentos"]
cultura            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Recreação e cultura"]
contribuicoes_trab <- tradutor$Codigo[tradutor$Descricao_3_novo == "Contribuições trabalhistas"]
fumo               <- tradutor$Codigo[tradutor$Descricao_3_novo == "Fumo"]
transporte         <- tradutor$Codigo[tradutor$Descricao_3_novo == "Transporte"]
alimentacao        <- tradutor$Codigo[tradutor$Descricao_3_novo == "Alimentacao"]
serv_banc          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Serviços bancários"]
serv_pess          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Serviços pessoais"]
assist_saude       <- tradutor$Codigo[tradutor$Descricao_3_novo == "Assistencia a saude"]
higiene            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Higiene e cuidados pessoais"]
educacao           <- tradutor$Codigo[tradutor$Descricao_3_novo == "Educacao"]
vestuario          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Vestuario"]
emprestimo         <- tradutor$Codigo[tradutor$Descricao_3_novo == "Empréstimo"]
prev_priv          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Previdência privada"]
pensoes            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Pensões, mesadas e doações"]
expenditures_pof <- tables_pof %>%
group_by(idorighh) %>%
summarise(
habitacao            = sum(V8000_DEFLA_new[V9001 %in% habitacao]),
despesas_diversas    = sum(V8000_DEFLA_new[V9001 %in% despesas_diversas]),
prestacao            = sum(V8000_DEFLA_new[V9001 %in% prestacao]),
impostos             = sum(V8000_DEFLA_new[V9001 %in% impostos]),
imovel               = sum(V8000_DEFLA_new[V9001 %in% imovel]),
outras               = sum(V8000_DEFLA_new[V9001 %in% outras]),
investimentos        = sum(V8000_DEFLA_new[V9001 %in% investimentos]),
cultura              = sum(V8000_DEFLA_new[V9001 %in% cultura]),
contribuicoes_trab   = sum(V8000_DEFLA_new[V9001 %in% contribuicoes_trab]),
fumo                 = sum(V8000_DEFLA_new[V9001 %in% fumo]),
transporte           = sum(V8000_DEFLA_new[V9001 %in% transporte]),
alimentacao          = sum(V8000_DEFLA_new[V9001 %in% alimentacao]),
serv_banc            = sum(V8000_DEFLA_new[V9001 %in% serv_banc]),
serv_pess            = sum(V8000_DEFLA_new[V9001 %in% serv_pess]),
assist_saude         = sum(V8000_DEFLA_new[V9001 %in% assist_saude]),
higiene              = sum(V8000_DEFLA_new[V9001 %in% higiene]),
educacao             = sum(V8000_DEFLA_new[V9001 %in% educacao]),
vestuario            = sum(V8000_DEFLA_new[V9001 %in% vestuario]),
emprestimo           = sum(V8000_DEFLA_new[V9001 %in% emprestimo]),
prev_priv            = sum(V8000_DEFLA_new[V9001 %in% prev_priv]),
pensoes              = sum(V8000_DEFLA_new[V9001 %in% pensoes])) %>%
mutate(across(everything(), as.numeric))
DESPESA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
DESPESA_INDIVIDUAL <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_INDIVIDUAL.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
CADERNETA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
tables_pof <- do.call(rbind,
list(DESPESA_COLETIVA,
DESPESA_INDIVIDUAL,
CADERNETA_COLETIVA)) %>%
mutate(across(everything(), as.numeric))
tradutor <- read_xls("Database setup\\Expenditure imputation\\general_expenditure_translator.xls", )
habitacao          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Habitacao"]
despesas_diversas  <- tradutor$Codigo[tradutor$Descricao_3_novo == "Despesas diversas"]
prestacao          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Prestação de imóvel"]
impostos           <- tradutor$Codigo[tradutor$Descricao_3_novo == "Impostos"]
imovel             <- tradutor$Codigo[tradutor$Descricao_3_novo == "Imóvel (reforma)" |
tradutor$Descricao_3_novo == "Imóvel (aquisição)"]
outras             <- tradutor$Codigo[tradutor$Descricao_3_novo == "Outras"]
investimentos      <- tradutor$Codigo[tradutor$Descricao_3_novo == "Outros investimentos"]
cultura            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Recreação e cultura"]
contribuicoes_trab <- tradutor$Codigo[tradutor$Descricao_3_novo == "Contribuições trabalhistas"]
fumo               <- tradutor$Codigo[tradutor$Descricao_3_novo == "Fumo"]
transporte         <- tradutor$Codigo[tradutor$Descricao_3_novo == "Transporte"]
alimentacao        <- tradutor$Codigo[tradutor$Descricao_3_novo == "Alimentacao"]
serv_banc          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Serviços bancários"]
serv_pess          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Serviços pessoais"]
assist_saude       <- tradutor$Codigo[tradutor$Descricao_3_novo == "Assistencia a saude"]
higiene            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Higiene e cuidados pessoais"]
educacao           <- tradutor$Codigo[tradutor$Descricao_3_novo == "Educacao"]
vestuario          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Vestuario"]
emprestimo         <- tradutor$Codigo[tradutor$Descricao_3_novo == "Empréstimo"]
prev_priv          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Previdência privada"]
pensoes            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Pensões, mesadas e doações"]
DESPESA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(str_sub(V9001,-3) != "999" &
as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
DESPESA_INDIVIDUAL <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_INDIVIDUAL.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(str_sub(V9001,-3) != "999" &
as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
CADERNETA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(str_sub(V9001,-3) != "999" &
as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
tables_pof <- do.call(rbind,
list(DESPESA_COLETIVA,
DESPESA_INDIVIDUAL,
CADERNETA_COLETIVA)) %>%
mutate(across(everything(), as.numeric))
expenditures_pof_2 <- tables_pof %>%
group_by(idorighh) %>%
summarise(
habitacao            = sum(V8000_DEFLA_new[V9001 %in% habitacao]),
despesas_diversas    = sum(V8000_DEFLA_new[V9001 %in% despesas_diversas]),
prestacao            = sum(V8000_DEFLA_new[V9001 %in% prestacao]),
impostos             = sum(V8000_DEFLA_new[V9001 %in% impostos]),
imovel               = sum(V8000_DEFLA_new[V9001 %in% imovel]),
outras               = sum(V8000_DEFLA_new[V9001 %in% outras]),
investimentos        = sum(V8000_DEFLA_new[V9001 %in% investimentos]),
cultura              = sum(V8000_DEFLA_new[V9001 %in% cultura]),
contribuicoes_trab   = sum(V8000_DEFLA_new[V9001 %in% contribuicoes_trab]),
fumo                 = sum(V8000_DEFLA_new[V9001 %in% fumo]),
transporte           = sum(V8000_DEFLA_new[V9001 %in% transporte]),
alimentacao          = sum(V8000_DEFLA_new[V9001 %in% alimentacao]),
serv_banc            = sum(V8000_DEFLA_new[V9001 %in% serv_banc]),
serv_pess            = sum(V8000_DEFLA_new[V9001 %in% serv_pess]),
assist_saude         = sum(V8000_DEFLA_new[V9001 %in% assist_saude]),
higiene              = sum(V8000_DEFLA_new[V9001 %in% higiene]),
educacao             = sum(V8000_DEFLA_new[V9001 %in% educacao]),
vestuario            = sum(V8000_DEFLA_new[V9001 %in% vestuario]),
emprestimo           = sum(V8000_DEFLA_new[V9001 %in% emprestimo]),
prev_priv            = sum(V8000_DEFLA_new[V9001 %in% prev_priv]),
pensoes              = sum(V8000_DEFLA_new[V9001 %in% pensoes])) %>%
mutate(across(everything(), as.numeric))
View(expenditures_pof)
View(expenditures_pof_2)
mean(expenditures_pof$habitacao)
mean(expenditures_pof_2$habitacao)
plot(density(expenditures_pof$habitacao))
plot(density((expenditures_pof %>% filter(habitacao > 100))$habitacao))
plot(density((expenditures_pof %>% filter(habitacao > 100 & habitacao < 10000))$habitacao))
plot(density((expenditures_pof %>% filter(habitacao > 100 & habitacao < 2500))$habitacao))
plot(density((expenditures_pof_2 %>% filter(habitacao > 100 & habitacao < 2500))$habitacao))
plot(density((expenditures_pof %>% filter(alimentacao > 100 & alimentacao < 2500))$alimentacao))
plot(density((expenditures_pof_2 %>% filter(alimentacao > 100 & alimentacao < 2500))$alimentacao))
DESPESA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_COLETIVA.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
DESPESA_INDIVIDUAL <- readRDS("Database setup\\Expenditure imputation\\POF data\\DESPESA_INDIVIDUAL.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
mutate(V9011 = ifelse(is.na(V9011), 1, V9011)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*V9011*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
CADERNETA_COLETIVA <- readRDS("Database setup\\Expenditure imputation\\POF data\\CADERNETA_COLETIVA.rds") %>%
mutate(V9001 = str_sub(V9001, 1, -3)) %>%
mutate(idorighh = paste0(COD_UPA, NUM_DOM, NUM_UC)) %>%
filter(as.numeric(V9002) <= 6) %>%
mutate(V8000_DEFLA_new = (V8000_DEFLA*FATOR_ANUALIZACAO)*inflation_correction/12) %>%
select(idorighh, V9001, V8000_DEFLA_new, UF)
tables_pof <- do.call(rbind,
list(DESPESA_COLETIVA,
DESPESA_INDIVIDUAL,
CADERNETA_COLETIVA)) %>%
mutate(across(everything(), as.numeric))
#Codes for expenditure categories (already taken from POF's own categorization)
tradutor <- read_xls("Database setup\\Expenditure imputation\\general_expenditure_translator.xls", )
habitacao          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Habitacao"]
despesas_diversas  <- tradutor$Codigo[tradutor$Descricao_3_novo == "Despesas diversas"]
prestacao          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Prestação de imóvel"]
impostos           <- tradutor$Codigo[tradutor$Descricao_3_novo == "Impostos"]
imovel             <- tradutor$Codigo[tradutor$Descricao_3_novo == "Imóvel (reforma)" |
tradutor$Descricao_3_novo == "Imóvel (aquisição)"]
outras             <- tradutor$Codigo[tradutor$Descricao_3_novo == "Outras"]
investimentos      <- tradutor$Codigo[tradutor$Descricao_3_novo == "Outros investimentos"]
cultura            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Recreação e cultura"]
contribuicoes_trab <- tradutor$Codigo[tradutor$Descricao_3_novo == "Contribuições trabalhistas"]
fumo               <- tradutor$Codigo[tradutor$Descricao_3_novo == "Fumo"]
transporte         <- tradutor$Codigo[tradutor$Descricao_3_novo == "Transporte"]
alimentacao        <- tradutor$Codigo[tradutor$Descricao_3_novo == "Alimentacao"]
serv_banc          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Serviços bancários"]
serv_pess          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Serviços pessoais"]
assist_saude       <- tradutor$Codigo[tradutor$Descricao_3_novo == "Assistencia a saude"]
higiene            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Higiene e cuidados pessoais"]
educacao           <- tradutor$Codigo[tradutor$Descricao_3_novo == "Educacao"]
vestuario          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Vestuario"]
emprestimo         <- tradutor$Codigo[tradutor$Descricao_3_novo == "Empréstimo"]
prev_priv          <- tradutor$Codigo[tradutor$Descricao_3_novo == "Previdência privada"]
pensoes            <- tradutor$Codigo[tradutor$Descricao_3_novo == "Pensões, mesadas e doações"]
expenditures_pof <- tables_pof %>%
group_by(idorighh) %>%
summarise(
habitacao            = sum(V8000_DEFLA_new[V9001 %in% habitacao]),
despesas_diversas    = sum(V8000_DEFLA_new[V9001 %in% despesas_diversas]),
prestacao            = sum(V8000_DEFLA_new[V9001 %in% prestacao]),
impostos             = sum(V8000_DEFLA_new[V9001 %in% impostos]),
imovel               = sum(V8000_DEFLA_new[V9001 %in% imovel]),
outras               = sum(V8000_DEFLA_new[V9001 %in% outras]),
investimentos        = sum(V8000_DEFLA_new[V9001 %in% investimentos]),
cultura              = sum(V8000_DEFLA_new[V9001 %in% cultura]),
contribuicoes_trab   = sum(V8000_DEFLA_new[V9001 %in% contribuicoes_trab]),
fumo                 = sum(V8000_DEFLA_new[V9001 %in% fumo]),
transporte           = sum(V8000_DEFLA_new[V9001 %in% transporte]),
alimentacao          = sum(V8000_DEFLA_new[V9001 %in% alimentacao]),
serv_banc            = sum(V8000_DEFLA_new[V9001 %in% serv_banc]),
serv_pess            = sum(V8000_DEFLA_new[V9001 %in% serv_pess]),
assist_saude         = sum(V8000_DEFLA_new[V9001 %in% assist_saude]),
higiene              = sum(V8000_DEFLA_new[V9001 %in% higiene]),
educacao             = sum(V8000_DEFLA_new[V9001 %in% educacao]),
vestuario            = sum(V8000_DEFLA_new[V9001 %in% vestuario]),
emprestimo           = sum(V8000_DEFLA_new[V9001 %in% emprestimo]),
prev_priv            = sum(V8000_DEFLA_new[V9001 %in% prev_priv]),
pensoes              = sum(V8000_DEFLA_new[V9001 %in% pensoes])) %>%
mutate(across(everything(), as.numeric))
View(DESPESA_COLETIVA %>% select(V9004))
